---
import { sanityClient } from '../lib/sanity';

// 1. Buscando as categorias no Sanity
// "slug.current" pega apenas a string da URL
const query = `*[_type == "category"]{title, "slug": slug.current, group} | order(title asc)`;
const categories = await sanityClient.fetch(query);

// 2. Separando em grupos para os Dropdowns
const brasileirao = categories.filter((c: any) => c.group === 'brasileirao');
const soLendas = categories.filter((c: any) => c.group === 'so-lendas');
const olhoNoLance = categories.filter((c: any) => c.group === 'olho-no-lance');
---

<header class="bg-black text-white shadow-lg sticky top-0 z-50 border-b-4 border-green-600">
  <nav class="container mx-auto px-4 py-4 flex justify-between items-center relative">
    
    <a href="/" class="text-2xl md:text-3xl font-black italic tracking-tighter hover:text-green-500 transition">
      BORA <span class="text-green-500">JOGADOR</span>
    </a>

    <div class="hidden md:flex space-x-8 items-center font-bold uppercase text-sm">
      <a href="/" class="hover:text-green-400 transition">Home</a>

      <div class="group relative py-4">
        <button class="flex items-center hover:text-green-400 transition">
          Brasileirão 
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
        <div class="absolute left-0 mt-2 w-48 bg-white text-black rounded-md shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top">
          {brasileirao.map((cat: any) => (
            <a href={`/categoria/${cat.slug}`} class="block px-4 py-3 hover:bg-green-50 hover:text-green-700 border-b border-gray-100 last:border-0">
              {cat.title}
            </a>
          ))}
        </div>
      </div>

      <div class="group relative py-4">
        <button class="flex items-center hover:text-green-400 transition">
          Só Lendas
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
        <div class="absolute left-0 mt-2 w-48 bg-white text-black rounded-md shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top">
          {soLendas.map((cat: any) => (
            <a href={`/categoria/${cat.slug}`} class="block px-4 py-3 hover:bg-green-50 hover:text-green-700 border-b border-gray-100 last:border-0">
              {cat.title}
            </a>
          ))}
        </div>
      </div>

      <div class="group relative py-4">
        <button class="flex items-center hover:text-green-400 transition">
          Olho no Lance
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
        <div class="absolute left-0 mt-2 w-48 bg-white text-black rounded-md shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top">
          {olhoNoLance.map((cat: any) => (
            <a href={`/categoria/${cat.slug}`} class="block px-4 py-3 hover:bg-green-50 hover:text-green-700 border-b border-gray-100 last:border-0">
              {cat.title}
            </a>
          ))}
        </div>
      </div>

      <a href="/sobre" class="hover:text-green-400 transition">Nossa História</a>
      <a href="/contato" class="hover:text-green-400 transition">Contato</a>
    </div>

    <button id="mobile-menu-btn" class="md:hidden text-white focus:outline-none">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>
  </nav>

  <div id="mobile-menu" class="fixed inset-y-0 right-0 w-64 bg-zinc-900 shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 overflow-y-auto">
    <div class="p-6">
      <div class="flex justify-between items-center mb-8">
        <span class="font-bold text-xl italic">MENU</span>
        <button id="close-menu-btn" class="text-gray-400 hover:text-white">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
      </div>

      <div class="flex flex-col space-y-4 font-bold">
        <a href="/" class="block py-2 border-b border-zinc-800">HOME</a>
        
        <div class="py-2 border-b border-zinc-800">
          <span class="text-green-500 text-sm mb-2 block uppercase">Brasileirão</span>
          {brasileirao.map((cat: any) => (
            <a href={`/categoria/${cat.slug}`} class="block py-2 pl-4 text-gray-300 hover:text-white text-sm font-normal">
              {cat.title}
            </a>
          ))}
        </div>

        <div class="py-2 border-b border-zinc-800">
          <span class="text-green-500 text-sm mb-2 block uppercase">Só Lendas</span>
          {soLendas.map((cat: any) => (
             <a href={`/categoria/${cat.slug}`} class="block py-2 pl-4 text-gray-300 hover:text-white text-sm font-normal">
              {cat.title}
            </a>
          ))}
        </div>

        <div class="py-2 border-b border-zinc-800">
          <span class="text-green-500 text-sm mb-2 block uppercase">Olho no Lance</span>
          {olhoNoLance.map((cat: any) => (
             <a href={`/categoria/${cat.slug}`} class="block py-2 pl-4 text-gray-300 hover:text-white text-sm font-normal">
              {cat.title}
            </a>
          ))}
        </div>

        <a href="/sobre" class="block py-2">NOSSA HISTÓRIA</a>
        <a href="/contato" class="block py-2">CONTATO</a>
      </div>
    </div>
  </div>
</header>

<script>
  // Lógica Simples do Menu Mobile
  const menuBtn = document.getElementById('mobile-menu-btn');
  const closeBtn = document.getElementById('close-menu-btn');
  const menu = document.getElementById('mobile-menu');

  function toggleMenu() {
    menu?.classList.toggle('translate-x-full');
  }

  menuBtn?.addEventListener('click', toggleMenu);
  closeBtn?.addEventListener('click', toggleMenu);
</script>
